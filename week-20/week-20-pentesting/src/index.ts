import express from "express";

const app = express();

app.use(express.json());

const OtpRecord: Record<string, string> = {};

app.post("/generate-otp", (req: any, res: any) => {
  const email = req.body.email;
  if (!email) {
    return res.status(411).json({ message: "Email is required" });
  }

  const otp = Math.floor(100000 + Math.random() * 900000).toString();

  console.log(`Otp for ${email} is ${otp}`);
  OtpRecord[email] = otp;
  res.status(200).json({ message: "OTP generated" });
});
const PORT = 3000;
app.listen(PORT, () => {
  console.log("Server is running on port " + PORT);
});

app.post("/rest-password", (req, res) => {
  const otp = req.body.otp;
  const email = req.body.email;

if(!otp||!email){
        res.status(411).json({
                "Msg": "OTP and Email req"
        })
}
if (OtpRecord[email] === otp) {
    console.log("Otp matched Password reset done");
    res.status(200).json({
      msg: "Password reset done",
    });
  }
  else{

          res.status(590).json({"Error":"invalid otp"})
  }
});
